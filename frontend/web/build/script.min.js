var tag = document.createElement('script');

tag.src = "https://www.youtube.com/iframe_api";
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

var player;

function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
        videoId : $('#player').data('video-id'),
        height: '390',
        width: '640',
        events: {
            'onReady': onPlayerReady()
        }
    });
}

function onPlayerReady(event) {
    var playButton = document.getElementById("btn_video");
    if ((playButton === null) || (playButton === undefined)) {
        return;
    }
    playButton.addEventListener("click", function (event) {
        if (typeof player.playVideo == 'function') {
            player.playVideo();
        } else {
            console.log(player)
        }
        $('.landing--video').addClass('video_played');
    });
}

$('#btn_video').click(function () {
    $('.landing--video').addClass('video_played');
});


setInterval(function () {
    player = new YT.Player('player', {
        videoId : $('#player').data('video-id'),
        height: '390',
        width: '640',
        events: {
            'onReady': onPlayerReady()
        }
    });
}, 600);
var wH = $(window).height(),
    wW = $(window).width(),
    ua = navigator.userAgent,
    touchendOrClick = (ua.match(/iPad|iPhone|iPad/i)) ? "touchend" : "click",

    deviceAgent = navigator.userAgent.toLowerCase(),
    isMobile = deviceAgent.match(/(iphone|ipod|ipad)/);

FastClick.attach(document.body);

if (isMobile || wW <= 767) {
    $('body').addClass('is_mobile');
} else {
    $('body').removeClass('is_mobile');
}

function initResize() {
    $(window).resize(function() {
        setTimeout(function() {
            $('.header_container').css({
                height: $('.header').outerHeight()
            });
        }, 30);

        $('.video iframe').css({
            maxHeight: $(window).outerHeight() - $('header').outerHeight()
        });

        $('body').css({
            paddingBottom: $('footer').outerHeight()
        })
    }).trigger('resize');
}

function initEventsOnClick() {
    $('[data-control="select"] ._value').text($(this).siblings('select').val());
    $('[data-control="select"] select').on('change', function() {
        $(this).siblings('.select__value').find('._value').text(this.value);
    });

    $('.action_follow').on('click', function() {
        $(this).toggleClass('active')
    });

    // Tel
    if (!isMobile) {
        $('body').on('click', 'a[href^="tel:"]', function() {
            $(this).attr('href',
                $(this).attr('href').replace(/^tel:/, 'callto:'));
        });
    }
}

function initEventsOnScroll() {
    $(window).scroll(function() {
        if($(window).scrollTop() + $(window).height() > $(document).height() - 100) {
            $('body').find('#launcher, .btn_feedback').css({
                bottom: $('.footer').outerHeight()
            })
        }

        else {
            $('body').find('#launcher, .btn_feedback').css({
                bottom: 0
            })
        }
    });
}

// Messages

function initMessages() {
    var msg = $('#msg');

    $('.form--message').on('click', function(e) {e.stopPropagation()})
    msg.bind('focus', function(){ $(this).parents('.form--message').addClass('focused'); })
        .keyup(function(){
            if ($(this).val()) { $(this).parents('.form--message').addClass('with_value'); }
            else { $(this).parents('.form--message').removeClass('with_value'); }
        })

    msg.each(function(){ autosize(this); })
        .on('autosize:resized', function(){
            $('.message_card__inner').css({ height: 'auto' })
        });

    $('body').on('click', function() {
        if (!msg.val()) {
            $('.form--message').removeClass("focused");
            $('.message_card__inner').removeAttr('style');
        }
    });
}

// Header

function initHeader() {
    if (isMobile || wW <= 768) {
        $('.header_nav .nav_list__item > a').on('click', function(e) {
            e.stopPropagation();

            var href = $(this).attr('href');

            if (!$(this).parent('.nav_list__item').hasClass('nav_list__item--selected')) {
                $('.header_nav').addClass('header_nav--selected');
                $('.header_nav .nav_list__item').removeClass('nav_list__item--selected');
                $(this).parent('.nav_list__item').addClass('nav_list__item--selected');
                e.preventDefault();
            } else {
                return true;
            }
        });

    } else {
        hideSubMenu();
    }

    $('.btn_menu').on('click', function(e) {
        e.preventDefault();
        e.stopPropagation();

        $('body').addClass('body--menu_opened');
        $('.sidebar_menu').addClass('sidebar_menu--open');
    });

    $('.sidebar_menu, .header_search').on('click', function(e) {
        e.stopPropagation();
    });

    $('body, .btn_close_menu, .menu_overlay, .btn_close_header').on('click', function() {
        $('body').removeClass('body--menu_opened body--search_showed');
        $('.sidebar_menu').removeClass('sidebar_menu--open');
        $('.header_search').removeClass('header_search--show');
        hideSubMenu();
    });

    $('.btn_open_search').on('click', function(e) {
        e.preventDefault();
        e.stopPropagation();

        $('body').addClass('body--search_showed');
        $('.header_search').addClass('header_search--show');
    });
}

function hideSubMenu() {
    $('.header_nav').removeClass('header_nav--selected');
    $('.nav_list__item').removeClass('nav_list__item--selected');
}

// Collapse

function initCollapse() {
    $('.panel_collapse').on('show.bs.collapse', function () {
        $(this).siblings('.panel_heading').addClass('panel_heading--active');
    });

    $('.panel_collapse').on('hide.bs.collapse', function () {
        $(this).siblings('.panel_heading').removeClass('panel_heading--active');
    });
}


// b2b accelerate form

function initForms() {
    var $target,
        hash = window.location.hash;

    if (window.location.hash) {
        $('html, body').animate({
            scrollTop: $(hash).offset().top
        }, 0);

        $target = hash;

        $(hash).removeClass('hide');
        $('.btn_show_form').hide();
    }

    $('.btn_show_form').on('click', function() {
        $target = $(this).data('target');

        $(this).hide();
        $($target).removeClass('hide')
    });

    $('.btn_close_form').on('click', function() {
        $('.btn_show_form').show();
        $($target).addClass('hide');
    });

}


// Smooth scroll

function initSmoothScroll() {
    $('.smooth_scroll').click(function() {
        if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
            var target = $(this.hash);
            target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
            if (target.length) {
                $('html, body').animate({
                    scrollTop: target.offset().top
                }, 1000);
                return false;
            }
        }
    });
}



// Affix

function initAffix() {
    $('.btn_affix').affix({
        offset: {
            top: function () {
                return (this.top =  $('.site_nav').offset().top - $('.header_container').outerHeight())
            }
        }
    });

    $(window).resize(function() {
        $('.btn_affix').css({
            right: $('.header .container').offset().left + 15
        })
    }).trigger('resize')
}

function initStickyNav() {
    var didScroll;
    var lastScrollTop = 0;
    var delta = 5;
    var navHeight = $('.header_nav').outerHeight();

    $(window).scroll(function(event){
        didScroll = true;
    });

    setInterval(function() {
        if (didScroll) {
            hasScrolled();
            didScroll = false;
        }
    }, 250);

    function hasScrolled() {
        var st = $(this).scrollTop();

        // Make sure they scroll more than delta
        if(Math.abs(lastScrollTop - st) <= delta) {
            return;
        }

        if (st > lastScrollTop && st > navHeight){
            // Scroll Down
            hideSubMenu();
            $('.header_nav, .header, .btn_affix')
                .removeClass('nav_down')
                .addClass('nav_up');
        } else {
            // Scroll Up
            hideSubMenu();
            if(st + $(window).height() < $(document).height()) {
                $('.header_nav, .header, .btn_affix')
                    .removeClass('nav_up')
                    .addClass('nav_down')
            }
        }

        lastScrollTop = st;
    }

    $(window).resize(function() {
        setTimeout(function() {
            $('.header_nav').css({
                paddingTop: $('.header').outerHeight()
            });
        }, 30)
    }).trigger('resize');
}

// Init

$(document).ready(function() {
    initResize();
    initEventsOnClick();
    initEventsOnScroll();
    initMessages();
    initHeader();
    initStickyNav();
    initCollapse();
    initForms();
    initSmoothScroll();
    initAffix();
});


function myValidateEmail(email) {
    var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    return re.test(email);
}

//b2b logic for hidden imputs
$("#Dr, #Mr, #Mrs, #Ms").change(function () {
    var titleOptionsArr = document.querySelectorAll('#physics_title > option');
    for (var i = 0; i < titleOptionsArr.length; i++) {
        titleOptionsArr[i].removeAttribute('selected');
    }

    var valId = this.id;
    $("#physics_title option[value=" + valId + "]").attr('selected', 'true');
});

$("#hear1, #hear2, #hear3, #hear4").change(function () {
    var leadOptionsArr = document.querySelectorAll('#physics_lead > option');
    for (var i = 0; i < leadOptionsArr.length; i++) {
        leadOptionsArr[i].removeAttribute('selected');
    }


    var valValue = this.value;
    $("#physics_lead option[value='" + valValue + "']").attr('selected', 'true');
    if (this.id == 'hear4') {
        $('input#other').removeAttr('disabled');
    } else {
        $('input#other').attr('disabled', 'disabled');
    }

});

$('.form_accelerate').attr('novalidate', true);

$('.form_accelerate').submit(function () {
    var email = $('input[name="EMAIL"]').val();
    if(!myValidateEmail(email)){
        $('input[name="EMAIL"]').addClass('error');
    }else{
        $('input[name="EMAIL"]').removeClass('error');
    }

    if (!event.target.checkValidity()) {
        event.preventDefault();
        var tempAlert = document.querySelectorAll('.temp-alert');
        var i;
        for ( i = 0; i < tempAlert.length; i++) {
            tempAlert[i].remove();
        }
        for ( i = 0; i < event.srcElement.length; i++) {
            var srcElem = event.srcElement[i];
            if (srcElem.value === '' && srcElem.required === true) {
                var alert = document.createElement('span');
                alert.innerHTML = 'Please fill out this field';
                alert.setAttribute('style', 'color:red;');
                alert.setAttribute('class', 'temp-alert');

                if (srcElem.parentElement.getAttribute('class') === 'select') {
                    srcElem.parentElement.parentElement.appendChild(alert);
                } else {
                    srcElem.parentElement.appendChild(alert);
                }

            }
        }
    }

});

// var form = document.querySelector('.form_accelerate');
// if (form != null) {
//     form.noValidate = true;
//     form.addEventListener('submit', function (event) {
//         if (!event.target.checkValidity()) {
//             event.preventDefault();
//             var tempAlert = document.querySelectorAll('.temp-alert');
//             for (var i = 0; i < tempAlert.length; i++) {
//                 tempAlert[i].remove();
//             }
//             for (var i = 0; i < event.srcElement.length; i++) {
//                 if (event.srcElement[i].value == '' && event.srcElement[i].required == true) {
//                     var alert = document.createElement('span');
//                     alert.innerHTML = 'Please fill out this field';
//                     alert.setAttribute('style', 'color:red;');
//                     alert.setAttribute('class', 'temp-alert');
//
//                     if (event.srcElement[i].parentElement.getAttribute('class') == 'select') {
//                         console.log(event.srcElement[i].parentElement.parentElement.appendChild(alert));
//                     } else {
//                         console.log(event.srcElement[i].parentElement.appendChild(alert));
//                     }
//
//                 }
//             }
//         }
//     }, false);
// }


window.onload = function () {
    $('input[name=COMPLETE_URL]').val(location.origin + '/b2b-thanks');
};
    

/**
 * Created by user on 28.04.2017.
 */

$(document).ready(function() {
    var totalValue = $('#invest_total__value-api').text().replace(/,/g,"");

    var privateWallets = $('#invest_private-wallets__value-api').text().replace(/,/g,"");
    var privateWalletsPercent = (parseInt(privateWallets, 10) * 100) / parseInt(totalValue, 10);

    var tradingWallets = $('#invest_trading-wallets__value-api').text().replace(/,/g,"");
    var tradingWalletsPercent = (parseInt(tradingWallets, 10) * 100) / parseInt(totalValue, 10);

    var treasuryCoins = $('#invest_treasury-coins__value-api').text().replace(/,/g,"");
    var treasuryCoinsPercent = (parseInt(treasuryCoins, 10) * 100) / parseInt(totalValue, 10);

    $('#invest_private-wallets__value-percent').text(privateWalletsPercent.toFixed(1));
    $('#invest_trading-wallets__value-percent').text(tradingWalletsPercent.toFixed(1));
    $('#invest_treasury-coins__value-percent').text(treasuryCoinsPercent.toFixed(1));

    $('#invest_private-wallets__line').attr('style', 'width:'+privateWalletsPercent+'%');
    $('#invest_trading-wallets__line').attr('style', 'width:'+tradingWalletsPercent+'%');
    $('#invest_treasury-coins__line').attr('style', 'width:'+treasuryCoinsPercent+'%');
});
$(function () {
    $('#leadership_modal').on('show.bs.modal', function (event) {
        console.log('showing');
        var target = $(event.relatedTarget);
        var image = target.find('.leadership_item__image').data('big-image'),
            content = target.find('.leadership_item__info').html();

        console.log(image);

        var modal = $(this);
        modal.find('.leadership_modal__image').css({backgroundImage: 'url('+image+')'});
        modal.find('.modal-title').text('New message to ');
        modal.find('.modal-body').html(content);
    })
});